/**
 * Tiny tiny_elediastyles commands.
 *
 * @module      tiny_elediastyles/commands
 * @copyright   2025 Alex Schander <alexander.schander@eledia.de>
 * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define(["core/str","tiny_elediastyles/common","tiny_elediastyles/options"],(function(t,e,n){return{getSetup:function(){return Promise.all([t.get_string("button_showStyles",e.component),t.get_string("button_clearStyles",e.component)]).then((function(t){var o=t[0],r=t[1];return function(t){var i=n.getShowClearButtonOption(t),s=n.getjsonDefinition(t)||"[]";if("string"==typeof s)try{s=JSON.parse(s)}catch(t){window.console.error("Error parsing style JSON:",t),s=[]}var c=n.getCssDefinition(t);t.once("init",(function(){if(c&&t.contentStyles.push(c),n.getUseExternalCss(t)){var e=(n.getExternalCssUrl(t)||"").trim();if(e)e.split(/\r?\n/).forEach((function(e){var n=e.trim();n&&t.contentCSS.push(n)}))}}));var a=function(){if(Array.isArray(s)){t.execCommand("FormatBlock",!1,"p");var e=t.selection.getSelectedBlocks();if(e&&e.length){var n=s.flatMap((function(t){return"block"===t.type&&t.classes?t.classes.split(" "):[]})),o=Array.from(new Set(n)).filter(Boolean);e.forEach((function(e){o.forEach((function(n){t.dom.removeClass(e,n)}))}))}s.forEach((function(e){if("inline"===e.type&&e.classes){var n="custom_inline_"+e.classes.replace(/\s+/g,"_");t.formatter.match(n)&&t.formatter.remove(n)}}))}},l=function(){var e=[];if(n.getShowClearButtonOption(t)||e.push({type:"menuitem",text:r,icon:"invert",onAction:function(){a()}}),!Array.isArray(s))return e;var o=s.map((function(e){return{type:"menuitem",text:e.title||e.classes,onAction:function(){!function(e,n){if("block"===(n=n||"block")){var o="custom_block_"+e.replace(/\s+/g,"_");t.formatter.register(o,{block:"div",classes:e,wrapper:!0}),t.formatter.toggle(o)}else o="custom_inline_"+e.replace(/\s+/g,"_"),t.formatter.register(o,{inline:"span",classes:e}),t.formatter.toggle(o)}(e.classes,e.type)},onSetup:function(){return setTimeout((function(){document.querySelectorAll(".tox-menu .tox-collection__item").forEach((function(t){t.getAttribute("aria-label")===(e.title||e.classes)&&(t.classList.add("eledia-style-item"),e.classes&&e.classes.split(" ").forEach((function(e){e&&t.classList.add(e)})))}))}),0),function(){}}}}));return e.concat(o)};t.on("keydown",(function(e){if("Enter"===e.key&&!e.shiftKey){var n=t.selection.getNode(),o=t.dom.getParents(n,(function(t){return s.some((function(e){return"block"===e.type&&t.classList.contains(e.classes)}))}),t.getBody());if(!o||0===o.length)return;var r=o[0],i=t.dom.getParent(n,"p,h1,h2,h3,h4,h5,h6,li");if(i&&t.dom.isEmpty(i)){e.preventDefault();var c=t.dom.create("p");t.dom.insertAfter(c,r),t.dom.remove(i),t.selection.setCursorLocation(c,0)}}})),t.ui.registry.addMenuButton(e.pluginButtonName,{icon:"color-levels",tooltip:o,fetch:function(t){t(l())}}),i&&t.ui.registry.addButton(e.pluginClearButtonName,{icon:"invert",tooltip:r,onAction:function(){a()}})}}))}}}));
//# sourceMappingURL=commands.min.js.map